# Worklog 2026-02-05

## Erledigt
- Repo-Überblick erstellt (README/QUICKSTART geprüft).
- Setup-/Startpfad für lokale Tests identifiziert (venv, requirements, migrate, runserver).
- Python-Umgebung geprüft: `.venv` vorhanden, Django 6.0.1 installiert.
- `static/` Ordner angelegt.
- `python manage.py check` ausgeführt: OK, keine Warnungen mehr.
- `python manage.py migrate` ausgeführt: alle Migrationen erfolgreich, `db.sqlite3` erzeugt.
- Superuser erstellt (Admin / admin@mlgruppe.de).
- UX-Fixes aus Feedback vorbereitet:
  - Admin-Links zeigen jetzt auf `/admin-dashboard/` statt Django-Admin.
  - Login-Button auf Startseite zeigt auf `/login/`.
  - Cloud-Storage-Button zeigt auf `/cloudstorage/core/`.
  - `/cloudstorage/` leitet jetzt auf Core-Dashboard (auth-geschützt) weiter.
  - Helpdesk-Dashboard und Ticket-Erstellung mittig begrenzt (max-width).
  - Login-Redirects in Lizenz-Mixins auf `/cloudstorage/accounts/login/` umgestellt.
- Multi-DB Vorbereitung:
  - `DB_ENGINE`-gesteuerte DB-Konfiguration in `config/settings/base.py`.
  - Dev/Prod nutzen die zentrale DB-Konfiguration.
  - `.env.example` erweitert (MSSQL, MongoDB-Platzhalter, DB-Optionen).
- Auth-Prep:
  - `.env.example` um OAuth-Platzhalter erweitert.
  - Doku `docs/AUTH_AND_DB_PREP.md` ergänzt (Rollout-Schritte).
- Helpdesk Ticket-Erstellung:
  - Superuser/Staff werden als Agent behandelt, damit Kunden-Suche/Auto-Fill sichtbar ist.
  - Agent-Create-UI zentriert (max-width) für konsistentes Layout.
- Multi-DB Vorbereitung:
  - `requirements*.txt` um optionale Treiber-Hinweise für MariaDB/MSSQL ergänzt.
- UI/UX:
  - Haupt-Dashboard zentriert (max-width + zentrierte Button-Reihe).
  - Classroom-Button im Haupt-Dashboard ausgeblendet.
  - Plugin-Übersicht im Haupt-Dashboard ergänzt.
  - Plugin-Übersicht per AJAX live aktualisiert (`/dashboard/plugins/`).
  - Plugin-Inhalte (Widgets) werden im Dashboard gerendert, nicht nur Status.
  - Plugin-Bereich im Dashboard breiter gesetzt.
  - Plugin-Bereich Position konfigurierbar (oben/unten/links/rechts/mitte) via Admin-Dashboard.
  - Plugin-Aktivierung: fehlerhafte `plugins.hooks` Imports in installierten Plugins korrigiert.
  - Plugin-Aktivierung: fehlerhafte `plugins.widgets/models` Imports in Weather/Clock korrigiert.
  - Pro-Plugin Dashboard-Position: konfigurierbar im Admin-Dashboard.
  - Dashboard rendert Plugins nach Position (top/left/center/right/bottom) und aktualisiert per AJAX.
  - Weather-Widget Fehlerzustand abgesichert (kein Template-Error).
  - Layout: Center-Spalte breiter (3/6/3) und Widgets in Spalten vollbreit.
  - Clock Preview: fehlerhafter `plugins.preview` Import korrigiert.
  - Demo Plugin Template hinzugefügt + ZIP Download in `static/plugin-templates/demo_widget.zip`.
  - Demo-Download-Link in der Plugin-Doku-UI ergänzt.
  - Pro-Plugin Reihenfolge innerhalb der Position (Row) ergänzt.
  - Reihen-Layout jetzt auch für Top/Bottom/Left/Right aktiviert.
  - Plugin-Grid im Dashboard vereinheitlicht: max. 3 Karten pro Reihe (responsive 1/2/3).
  - Plugin-Sektion optisch abgesetzt (Card mit Header + Hintergrund).
  - Dashboard Layout: Container breiter (fluid, max 1400px) und Center-Plugins volle Breite.
  - CRM Grundgerüst angelegt (Modelle, Admin, URL, Home-View + Template).
  - App-Toggle CRM ergänzt (Admin Dashboard + Dashboard Button).
  - Bedrock-Config: Settings + `.env.example` erweitert, Service-Wrapper hinzugefügt.
  - CRM Listen/Details (Accounts, Leads, Opportunities) + AI Actions ergänzt.
- CRM Filter/Search + Pipeline-Board ergänzt.
- Bedrock Test-UI + Endpoint hinzugefügt (/bedrock-test/).
- CRM Gruppenrechte (Orga lesen, Manager schreiben) als Mixins + Context-Flags.
- CRM Create/Edit UI für Account/Lead/Opportunity.
- Lead-Scoring: Regel-Score + AI-Score + Gesamt-Score, Recalc-Button, Anzeige in Listen/Details.
- E-Mail Templates + Versand in CRM (Templates, Send-Form, Versand-Logs).
- Migrationen für CRM/Scoring/Email-Templates ausgeführt.
- Gruppen `Orga` und `Manager` angelegt.
- CRM UI ausgebaut: einheitliche CRM-Navigation, bessere Form-Layouts, Detail-Ansichten mit Related-Listen, Score-Badges.
- App Toggles: CRM wird nun in Admin/System-Settings gespeichert.
- CRM Forms: Template-Syntax-Fehler behoben, Titel via Context gesetzt.
- Lead-Import (Handelsregister) vorbereitet: Profile, Staging, Jobs, Rate-Limit (60/h) + Admin-Aktionen.
- Handelsregister-Profile erweitert (Register-Nr/Gericht, Suchoptionen, Niederlassung) + Default-Profil "IT Beratung".
- Lead-Quellen UI im CRM + Staging-Review (Bearbeiten/Import) + Admin-Dashboard Links.
- Lead-Source Registry eingeführt, damit weitere legale Quellen als Plugins angebunden werden können.
- Lead-Staging erweitert um Lead-Quelle/Lead-Status (Pflichtfelder für Import).
- Lead-Staging Bulk-Import (Multi-Select) implementiert.
- Auto-Enrichment (legal, nur interne Daten): Staging-Leads ziehen E-Mail/Telefon/Name aus vorhandenen Accounts/Contacts/Leads.
- Enrichment-Status/Notes im Staging + Bulk-Aktion + Command `run_lead_enrichment`.
- Handelsregister Import: Keywords als String, User-Agent Header, Debug-Hinweis bei 0 Treffern.
- Handelsregister Import: Fallback-URL (welcome.xhtml + mask.do) bei 404.
- Handelsregister Import: ViewState aus mask.do extrahieren + POST über mask.do (JSF-kompatibel).
- Handelsregister Import: Endpoint-Fallbacks (erweitertesuche.xhtml, mask.do Typ n/e) + Preflight + 404-Handling.
- Handelsregister Import: Playwright (headless) eingebunden, echtes Browser-Posting statt requests.
- Debug bei 0 Treffern: HTML wird nach logs/handelsregister_last.html geschrieben.
- CRM Staging Filter: request.GET.status abgesichert (keine Template-Fehler ohne Query-Param).
- Handelsregister Playwright: Cookie-Banner akzeptieren, Navigation über "Erweiterte Suche", robuste Selectors mit Suffix.
- Debug: HTML nach logs/handelsregister_search.html geschrieben.
- Handelsregister Playwright: textarea schlagwoerter + radio schlagwortOptionen + PrimeFaces select _input handling.
- Handelsregister Debug: before/after submit HTML + wait for results (networkidle + Treffer/datatable).

## Offen / Nächster Schritt
- Dev-Server starten und UI-Seiten testen (Admin-Dashboard/System-Settings/Logins).
- Vorbereitung für Multi-DB (MongoDB, MariaDB, MSSQL) planen.
- Vorbereitung für Auth: Login per E-Mail + Option Microsoft/Google (vorbereiten, noch nicht integrieren).

## Notizen
- Für Installationen/DB-Migrationen sind Schreibrechte nötig.
